<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="icon" type="image/png" href="assets/images/logo-16x16.png" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Profile - page</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Major+Mono+Display" rel="stylesheet">
    <link href='https://cdn.jsdelivr.net/npm/boxicons@1.9.2/css/boxicons.min.css' rel='stylesheet'>

    <!-- Styles -->
    <link href="assets/css/bootstrap/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/style.css" rel="stylesheet">
    <link href="assets/css/components.css" rel="stylesheet">
    <link href="assets/css/profile.css" rel="stylesheet">
    <link href="assets/css/media.css" rel="stylesheet">
</head>

<body class="profile">
    <div class="row newsfeed-size">
        <div class="col-md-12 p-0">
            <nav id="navbar-main" class="navbar navbar-expand-lg shadow-sm sticky-top">
                <div class="w-100 justify-content-md-center">
                    <ul class="nav navbar-nav enable-mobile px-2 ">
                        <li class="nav-item">
                            <button type="button" class="btn nav-link p-0">
                                <img src="assets/images/icons/theme/post-image.png" class="f-nav-icon"
                                    alt="Quick make post"></button>
                        </li>
                        <li class="nav-item w-100 py-2">
                            <form class="d-inline form-inline w-100 px-4">
                                <div class="input-group">
                                    <input type="text" class="form-control search-input"
                                        placeholder="Search for people, companies, events and more..."
                                        aria-label="Search" aria-describedby="search-addon">
                                    <div class="input-group-append">
                                        <button class="btn search-button" type="button"><i class='bx bx-search'></i>
                                        </button>
                                    </div>

                                </div>
                            </form>
                        </li>
                    </ul>
                    <ul class="navbar-nav mr-5 flex-row" id="main_menu">
                        <a class="navbar-brand nav-item mr-lg-5" href="index.html"><img
                                src="assets/images/logo-64x64.png" width="40" height="40" class="mr-3" alt="Logo"></a>
                        <!-- Collect the nav links, forms, and other content for toggling -->
                        <form class="w-30 mx-2 my-auto d-inline form-inline mr-5">
                            <div class="input-group">
                                <input type="text" class="form-control search-input w-75"
                                    placeholder="Search for people, companies, events and more..." aria-label="Search"
                                    aria-describedby="search-addon">
                                <div class="input-group-append">
                                    <button class="btn search-button" type="button"><i
                                            class='bx bx-search'></i></button>
                                </div>
                            </div>
                        </form>
                        <div>
                            <button onclick="redirectToSignIn()"
                                style="border-style:none;border-radius:0.25rem;margin-left:350px;margin-top:5px;color:white;background-color:#007bff;padding:10px;width:80px;font-size:13px;">Log
                                out</button>
                            <script>
                                function redirectToSignIn() {
                                    // Redirect to the sign-in page
                                    window.location.href = 'sign-in.html';

                                    // Clear the localStorage
                                    localStorage.clear();
                                }
                            </script>
                        </div>

            </nav>
            <div class="row profile-right-side-content">
                <div class="user-profile">
                    <div class="profile-header-background" id="userCoverInfo">
                    </div>



                    <div class="row profile-rows">
                        <div class="col-md-3">
                            <div class="profile-info-left" id="userProfileInfo">
                                <!-- User profile information will be dynamically generated here -->
                            </div>
                        </div>



                        <div class="col-md-9 p-0">
                            <div class="profile-info-right">

                                <!-- Posts section -->
                                <div class="row">
                                    <div class="col-md-9 profile-center">
                                        <ul
                                            class="list-inline profile-links d-flex justify-content-between w-shadow rounded">
                                            <li class="list-inline-item profile-active">
                                                <a href="#">Timeline</a>
                                            </li>
                                            <li class="list-inline-item">
                                                <a href="#">About</a>
                                            </li>
                                            <li class="list-inline-item">
                                                <a href="friends.html">Friends</a>
                                            </li>
                                            <li class="list-inline-item">
                                                <a href="#">Photos</a>
                                            </li>
                                            <li class="list-inline-item dropdown">
                                                <a href="#" data-toggle="dropdown" aria-haspopup="true"
                                                    aria-expanded="false">
                                                    <i class='bx bx-dots-vertical-rounded'></i>
                                                </a>
                                                <div class="dropdown-menu dropdown-menu-right profile-ql-dropdown">
                                                    <a href="#" class="dropdown-item">Activity Log</a>
                                                    <a href="#" class="dropdown-item">Videos</a>
                                                    <a href="#" class="dropdown-item">Check-Ins</a>
                                                    <a href="#" class="dropdown-item">Events</a>
                                                    <a href="#" class="dropdown-item">Likes</a>
                                                </div>
                                            </li>
                                        </ul>


                                        <!-- HERE Publish Post Box -->
                                        <ul class="list-unstyled" id="publishBox" style="margin-bottom: 0;">
                                            <li class="media post-form w-shadow">
                                                <div class="media-body">
                                                    <div class="form-group post-input">
                                                        <textarea class="form-control" id="postForm" rows="2"
                                                            placeholder="What's on your mind?"></textarea>
                                                    </div>


                                                    <div class="row post-form-group">
                                                        <div class="col-md-9">
                                                            <button type="button"
                                                                class="btn btn-link post-form-btn btn-sm">
                                                                <i class='bx bx-images'></i>
                                                                <span>Photo/Video</span>
                                                            </button>
                                                            <button type="button"
                                                                class="btn btn-link post-form-btn btn-sm">
                                                                <i class='bx bxs-group'></i> <span>Tag
                                                                    Friends</span>
                                                            </button>
                                                            <button type="button"
                                                                class="btn btn-link post-form-btn btn-sm">
                                                                <i class='bx bxs-map'></i> <span>Check In</span>
                                                            </button>
                                                        </div>
                                                        <div class="col-md-3 text-right">
                                                            <button type="button"
                                                                class="btn btn-primary Publishbtn">Publish</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </li>
                                        </ul>
                                        <!-- publish box ended  -->
                                        <div
                                            class="bg-white profile-posts-options mt-5 mb-4 py-3 d-flex justify-content-between shadow-sm">
                                            <div class="col-md-3 col-sm-12">
                                                <h6 class="timeline-title">Posts</h6>
                                            </div>
                                            <div class="col-md-9 col-sm-12">
                                                <div class="timeline-manage">
                                                    <button type="button"
                                                        class="btn btn-quick-link join-group-btn border btn-sm tmo-buttons"><i
                                                            class='bx bxs-cog'></i> Manage Posts</button>
                                                    <button type="button"
                                                        class="btn btn-quick-link join-group-btn border btn-sm tmo-buttons"><i
                                                            class='bx bx-align-middle'></i> List View</button>
                                                    <button type="button"
                                                        class="btn btn-quick-link join-group-btn border btn-sm tmo-buttons"><i
                                                            class='bx bxs-grid-alt'></i> Grid View</button>
                                                </div>
                                            </div>
                                        </div>
                                        <!--Posts Section-->
                                        <div class="post border-bottom p-3 bg-white w-shadow">

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- New message modal -->
    <div class="modal fade" id="newMessageModal" tabindex="-1" role="dialog" aria-labelledby="newMessageModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header new-msg-header">
                    <h5 class="modal-title" id="newMessageModalLabel">Start new conversation</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body new-msg-body">
                    <form action="" method="" class="new-msg-form">
                        <div class="form-group">
                            <label for="message-text" class="col-form-label">Message:</label>
                            <textarea class="form-control search-input" rows="5" id="message-text"
                                placeholder="Type a message..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer new-msg-footer">
                    <button type="button" class="btn btn-primary btn-sm">Send message</button>
                </div>
            </div>
        </div>
    </div>



    <!-- Script for check match of the current user and the sign in user to display the box -->
    <script>
        const urlParams1 = new URLSearchParams(window.location.search);
        const profileName1 = urlParams1.get('publisher');
        // from the clicked name in the feed page
        const storedHandleFromSignIn = localStorage.getItem('handel'); // from sign in page
        const postForm = document.getElementById('publishBox');

        if (storedHandleFromSignIn === profileName1) {
            postForm.removeAttribute('disabled');
            postForm.style.display = 'block';
        } else {
            // Disable or hide the post form if handles don't match
            postForm.setAttribute('disabled', 'true');
            postForm.style.display = 'none';
        }
    </script>




    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const profileName = urlParams.get('publisher');

        function loadProfile(profileName) {
            // Fetch user information based on the selected name
            fetch(`https://json.almiraj.xyz/jsonProfile/${profileName}`)
                .then(response => response.json())
                .then(data => {
                    // Call a function to generate and update the profile HTML
                    generateProfileHTML(data);
                    // Call a function to display posts
                    loadPosts(profileName);
                })
                .catch(error => {
                    console.error('Error fetching user data:', error);
                });
        }

        function generateProfileHTML(userProfile) {
            const userProfileInfo = document.getElementById('userProfileInfo');
            const userBannerInfo = document.getElementById('userCoverInfo');

            // Generate dynamic HTML for user profile
            const profileHTML = `
                <div class="text-center">
                    <div class="profile-img w-shadow">
                        <div class="profile-img-overlay"></div>
                        <img src="/assets/images/users/${userProfile.handel}_pfp.jpg" alt="Avatar" class="avatar img-circle"  onerror="this.onerror=null; this.src='/assets/images/users/user-8.png';">
                        <div class="profile-img-caption">
                            <label for="updateProfilePic" class="upload">
                                <i class='bx bxs-camera'></i> Update
                                <input type="file" id="updateProfilePicInput" class="text-center upload">
                            </label>
                        </div>
                    </div>
                    <p class="profile-fullname mt-3" id="fullName">${userProfile.name}</p>
                    <p class="profile-username mb-3 text-muted">${userProfile.handel}</p>
                    <div class="intro mt-4">
                        <div class="intro mt-5 mv-hidden">
                            <div class="intro-item d-flex justify-content-between align-items-center">
                                <h3 class="intro-about" style="text-align:left">Other Social Accounts</h3>
                            </div>
                            <div class="intro-item d-flex justify-content-between align-items-center">
                                <p class="intro-title text-muted"><i
                                        class='bx bxl-facebook-square facebook-color'></i> <a href="#"
                                        target="_blank">facebook.com/${userProfile.name}</a></p>
                            </div>
                            <div class="intro-item d-flex justify-content-between align-items-center">
                                <p class="intro-title text-muted"><i
                                        class='bx bxl-twitter twitter-color'></i> <a href="#"
                                        target="_blank">twitter.com/${userProfile.name}</a></p>
                            </div>
                            <div class="intro-item d-flex justify-content-between align-items-center">
                                <p class="intro-title text-muted"><i
                                        class='bx bxl-instagram instagram-color'></i> <a href="#"
                                        target="_blank">instagram.com/${userProfile.name}</a></p>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            const bannerHTML = `
                        <a href="#" class="profile-cover">
                            <img src="assets/images/users/${userProfile.handel}_banner.jpg" alt="Profile Header Background" onerror="this.onerror=null; this.src='./assets/images/users/cover/cover-1.gif';" style="width: 100%; height: 300px;">
                            <div class="cover-overlay">
                                <a href="#" class="btn btn-update-cover"><i class='bx bxs-camera'></i> Update Cover
                                    Photo</a>
                            </div>
                        </a>

            `
            // Update the HTML content of userProfileInfo
            userProfileInfo.innerHTML = profileHTML;
            userBannerInfo.innerHTML = bannerHTML;
        }

        function loadPosts(profileName) {
            // Fetch and display user posts
            fetch(`https://json.almiraj.xyz/jsonProfile/${profileName}`)
                .then(response => response.json())
                .then(data => {
                    const userPosts = data.activites;
                    displayPosts(userPosts);
                })
                .catch(error => {
                    console.error('Error fetching user posts:', error);
                });
        }

        function displayPosts(posts) {
            // Get the HTML element with the class 'profile-center'
            const profileCenter = document.querySelector('.profile-center');

            // Iterate through each post and create HTML elements to display the content
            posts.forEach(post => {
                const postElement = document.createElement('div');
                postElement.className = 'post border-bottom p-3 bg-white w-shadow';

                postElement.innerHTML = `
                    <div class="media text-muted pt-3">
                        <img src="/assets/images/users/${profileName}_pfp.jpg" alt="Online user" class="mr-3 post-user-image" onerror="this.onerror=null; this.src='/assets/images/users/user-8.png';">
                        <div class="media-body pb-3 mb-0 small lh-125">
                            <div class="d-flex justify-content-between align-items-center w-100">
                                <a href="#" class="text-gray-dark post-user-name">${profileName}</a>
                            </div>
                            <span class="d-block">${new Date(post.Date * 1000).toLocaleDateString()}<i class='bx bx-globe ml-3'></i></span>
                        </div>
                    </div>
                    <div class="mt-3">
                        <p>${post.Content}</p>
                    </div>
                    <div class="d-block mt-3">
                        <!-- Uncomment the following line if you have an image URL in your JSON -->
                        <img src="/assets/images/posts/${profileName}_${post.id}_pic.jpg" class="post-content" onerror="this.style.display='none';">
                    </div>
                    
                `
                var reactionsDiv = document.createElement('div');
                reactionsDiv.className = 'mb-3 argon-reaction';

                // Create like button span
                var likeBtnSpan = document.createElement('span');
                likeBtnSpan.className = 'like-btn';

                // Create like button link
                var likeBtnLink = document.createElement('a');
                likeBtnLink.href = '#';
                likeBtnLink.className = 'post-card-buttons';
                likeBtnLink.id = 'reactions';
                likeBtnLink.innerHTML = `<i class='bx bxs-like mr-2'></i> ${post.likes}`;
                // Add a boolean variable to track the like state
                let isLiked = false;
                // Add click event listener to the reaction element
                likeBtnLink.addEventListener('click', function () {
                    // Toggle between liking and disliking
                    if (isLiked) {
                        // If already liked, dislike
                        post.likes--;
                        likeBtnLink.style.color = ''; // Reset to the default color

                    } else {
                        // If not liked, like
                        post.likes++;
                        likeBtnLink.style.color = 'blue'; // Set the color to blue or any desired color

                    }
                    // Update the UI
                    likeBtnLink.innerHTML = `<i class='bx bxs-like mr-2'></i> ${post.likes}`;

                    sendLikeRequest(profileName, post.id);
                    // Toggle the like state for the next click
                    isLiked = !isLiked;
                });
                function sendLikeRequest(handle, postId) {
                    const likeData = {
                        "handel": handle,
                        "id": postId,
                        "like?": 1
                    };


                    console.log('Data:', likeData);

                    console.log('Sending data to https://json.almiraj.xyz/add_like...');

                    postJSON('https://json.almiraj.xyz/add_like', likeData)
                        .then((responseData) => {
                            console.log(responseData);
                        })
                        .catch((error) => {
                            console.error(error);
                        });
                }
                const postJSON = async (url, jsonData) => {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(jsonData),
                    });

                    if (!response.ok) throw new Error(response.statusText);

                    const responseData = await response.json();
                    return responseData;
                };

                // Create reactions ul
                var reactionsUl = document.createElement('ul');
                reactionsUl.className = 'reactions-box dropdown-shadow';

                // Create reactions li elements
                var reactions = ['Like', 'Love', 'HaHa', 'Wow', 'Sad', 'Angry'];

                reactions.forEach(reaction => {
                    var reactionLi = document.createElement('li');
                    reactionLi.className = `reaction reaction-${reaction.toLowerCase()}`;
                    reactionLi.setAttribute('data-reaction', reaction);
                    // Add click event listener to the reaction element
                    reactionsUl.appendChild(reactionLi);
                });
                // Append elements to the DOM
                likeBtnSpan.appendChild(likeBtnLink);
                likeBtnSpan.appendChild(reactionsUl);
                reactionsDiv.appendChild(likeBtnSpan);
                postElement.appendChild(reactionsDiv);
                // Append the post element to the container
                profileCenter.appendChild(postElement);
            });
        }






        // Load the profile and posts when the page is loaded
        document.addEventListener('DOMContentLoaded', function () {
            loadProfile(profileName);
        });


    </script>









    <!-- For Add Post -->
    <script>
        const postJSON = async (url, jsonData) => {
            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(jsonData),
            });

            if (!response.ok) throw new Error(response.statusText);

            const responseData = await response.json();
            return responseData;
        };
        const PuplishBtn = document.querySelector('.Publishbtn');
        PuplishBtn.addEventListener('click', function () {
            const content = document.querySelector('[placeholder="What\'s on your mind?"]').value.trim();
            const postData = {
                // Initial data properties...
                "handel": localStorage.getItem('handel'), //current profile i want to publish the post
                "content": content

            };
            postJSON('https://json.almiraj.xyz/add_post', postData)
                .then((responseData) => {
                    console.log(responseData);
                })
                .catch((error) => {
                    console.error(error);
                });

        });
    </script>



















    <!-- Core -->
    <script src="assets/js/jquery/jquery-3.3.1.min.js"></script>
    <script src="assets/js/popper/popper.min.js"></script>
    <script src="assets/js/bootstrap/bootstrap.min.js"></script>

</body>

</html>